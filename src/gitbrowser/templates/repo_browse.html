{% extends "repository_template.html" %}
{% load gb_tags %}
{% load humanize %}

{% block title %}{% if repository.list_filter_path %}{{repository.list_filter_path}} in {% endif %}{{repository.name}}{% if repository.path %} :: {{repository.path}}{% endif %}{% endblock %}

{% block repository_content %}
	{% if repository.items %}
		<table class="table table-condensed tree-table" itemscope itemtype="http://schema.org/ItemList">
			{% if repository.list_filter_path_items|length > 0 %}
				<tr>
					<td class="tree-item-name">
						<a href="{% url 'browse_ref' repository.relative_path repository.list_filter_ref repository.list_filter_path_items|slice:":-1"|last|first %}"
									title="Browse {{repository.list_filter_path_items|slice:":-1"|last|last}}">..
						</a></td>
					<td colspan="2"></td>
				</tr>
			{% endif %}

			{% for item, commit in repository.items %}
				<tr itemprop="itemListElement">
					<td class="tree-item-name">
						<a href="
							{% if item.type == 'blob' %}
								{% url 'browse_blob' repository.relative_path repository.list_filter_ref item.path %}
							{% else %}
								{% url 'browse_ref' repository.relative_path repository.list_filter_ref item.path %}
							{% endif %}"
						   title="Show {{item.name}}" itemprop="name url">{{item.name}}</a>
					</td>
					<td class="text-muted tree-item-latest-commit">
						{% if commit %}
							<a class="text-muted"
								href="{% url 'commit' repository.relative_path commit.hexsha %}"
								title="{{commit.summary}}">{{commit.summary}}</a>
						{% endif %}
					</td>
					<td class="text-muted tree-item-latest-commit-date">
						{% if commit %}
							{{item.latest_commit.authored_datetime|time_tag}}
						{% endif %}
					</td>
				</tr>
			{% endfor %}
		</table>
	{% else %}
		<p>This is an empty repository</p>
	{% endif %}

{% endblock %}